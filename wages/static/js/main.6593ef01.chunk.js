(this.webpackJsonpwages_app=this.webpackJsonpwages_app||[]).push([[0],{20:function(e,t,a){e.exports={primary:"#1a1a1a",secondary:"#fff",success:"#4BBF73",info:"#1F9BCF",warning:"#f0ad4e",danger:"#d9534f",light:"#fff",dark:"#343a40",bodyBg:"#fff",fontFamily:'"Nunito Sans",-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Helvetica Neue",Arial,sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol"',fontColor:"#55595c"}},200:function(e,t,a){e.exports=a(201)},201:function(e,t,a){"use strict";a.r(t);var n=a(90),r=a(73),o=a(74),i=a(75),l=a(70),c=a(77),s=a(78),u=a(0),f=a.n(u),m=a(91),p=a.n(m),h=a(194),d=a.n(h),v=a(76),y=a(195),b=a(197),g=a(71),j=a(198),E=a(199),C=a(121),D=a(47),O=a.n(D),k=(a(211),a(20)),x=a.n(k),V=a(92),S=a.n(V);O.a.locale("fr");var w="https://www.landalvic.fr/melodi-api",B={colorway:[x.a.primary,x.a.success,x.a.info],paper_bgcolor:x.a.bodyBg,plot_bgcolor:x.a.bodyBg,autosize:!0,font:{family:x.a.fontFamily,color:x.a.fontColor},hoverlabel:{bordercolor:x.a.fontColor,bgcolor:x.a.bodyBg,font:{family:x.a.fontFamily,color:x.a.fontColor}}},T=function(e){Object(s.a)(a,e);var t=Object(c.a)(a);function a(e){var n;return Object(o.a)(this,a),(n=t.call(this,e)).state={filterDims:null,filterValues:[],plotData:new S.a([]),isLoading:!1},n.onMenuChange=n.onMenuChange.bind(Object(l.a)(n)),n}return Object(i.a)(a,[{key:"createDataFrame",value:function(e){try{var t=e.observations.map((function(e){var t=e.dimensions.reduce((function(e,t){return Object(r.a)({},e,Object(n.a)({},t.concept.code,t.modalite.code))}),{});return t=Object(r.a)({},t,{value:e.valeur})}));return new S.a(t,Object.keys(t[0]))}catch(a){return new S.a([])}}},{key:"dataRequest",value:function(){var e=this;this.setState({isLoading:!0},(function(){var t=Object.entries(e.state.filterValues).map((function(e){return e.join("=")})).join("&");fetch(w+"/data/"+e.props.dsd+"?"+t).then((function(e){return e.json()})).then((function(t){return e.setState({plotData:e.createDataFrame(t),isLoading:!1})}))}))}},{key:"onMenuChange",value:function(e,t){var a=this;this.setState((function(a){var n=a.filterValues;return n[e]=t,{filterValues:n}}),(function(){return a.dataRequest()}))}},{key:"componentDidMount",value:function(){var e=this;fetch(w+"/datastructure/"+this.props.dsd).then((function(e){return e.json()})).then((function(t){var a=t.dimensions.filter((function(t){return e.props.filterableDims.includes(t.concept.code)}));e.setState({filterDims:a},(function(){var t={};e.state.filterDims.map((function(e){t[e.concept.code]="TOTAL"})),e.setState({filterValues:t},(function(){return e.dataRequest()}))}))}))}},{key:"render",value:function(){return f.a.createElement(y.a,null,this.state.filterDims&&f.a.createElement(b.a,null,f.a.createElement(g.a,{xs:4},f.a.createElement(M,{filterDims:this.state.filterDims,filterValues:this.state.filterValues,onMenuChange:this.onMenuChange})),f.a.createElement(g.a,{xs:8,style:{display:"flex",justifyContent:"center",alignItems:"center"}},this.state.isLoading?f.a.createElement(j.a,{animation:"border"}):f.a.createElement(F,{plotData:this.state.plotData}))))}}]),a}(f.a.Component),F=function(e){Object(s.a)(a,e);var t=Object(c.a)(a);function a(e){var n;return Object(o.a)(this,a),(n=t.call(this,e)).df=n.props.plotData,n.measure="revenu_salarial_net_mensuel",n.min=n.measure+"_min",n.max=n.measure+"_max",n.byVar=null,n}return Object(i.a)(a,[{key:"formatData",value:function(){var e,t=this.byVar?["id",this.byVar]:["id"];this.df=(e=this.props.plotData.withColumn("id",(function(e){return parseInt(e.get("STAT").match("\\d+")[0])}))).groupBy.apply(e,t).pivot("MESURE",(function(e){return e.toArray("value")[0]})).sortBy("id")}},{key:"computeTickText",value:function(e){var t=this.df.filter((function(t){return e.includes(t.get("id"))}));return t=(t=this.byVar?t.sortBy(this.byVar):t).toArray(this.min).map((function(e){return O()(e).format("0,0$")})).slice(0,e.length)}},{key:"computeHoverText",value:function(){var e=this;this.df=this.df.withColumn("hovertext",(function(t){var a=O()(t.get(e.min)).format("0,0$"),n=O()(t.get(e.max)).format("0,0$"),r=t.get("effectifs");return["Entre",a,"et",n,":",r<1?"moins  de 1":O()(r).format("0,0"),r>1?"individus":"individu"].join(" ")}))}},{key:"selectPlotData",value:function(e){return e.select("id","effectifs","hovertext").renameAll(["x","y","hovertext"]).toDict()}},{key:"render",value:function(){var e=this;if(0===this.props.plotData.dim()[0])return f.a.createElement(E.a,{variant:"light"},"No data");this.formatData(),this.computeHoverText();var t={type:"bar",hoverinfo:"text"},a={};a=(a=this.byVar?this.df.groupBy(this.byVar).toCollection().map((function(t){var a=e.selectPlotData(t.group);return a.name=t.groupKey[e.byVar],a.opacity=.5,a})):[this.selectPlotData(this.df)]).map((function(e){return Object(r.a)({},e,{},t)}));var n=[1,25,50,75,99],o={bargap:0,barmode:"overlay",xaxis:{tickmode:"array",tickvals:n,ticktext:this.computeTickText(n)}};return f.a.createElement(d.a,{data:a,layout:Object(r.a)({},B,{},o),useResizeHandler:!0,style:{width:"100%",height:"100%"}})}}]),a}(f.a.Component),M=function(e){Object(s.a)(a,e);var t=Object(c.a)(a);function a(){return Object(o.a)(this,a),t.apply(this,arguments)}return Object(i.a)(a,[{key:"render",value:function(){var e=this,t=this.props.filterDims.map((function(t,a){return f.a.createElement(_,{key:a,filterDim:t,filterValue:e.props.filterValues[t.concept.code],onMenuChange:e.props.onMenuChange})}));return f.a.createElement(C.a,null,f.a.createElement(C.a.Body,null,f.a.createElement(v.a,null,t)))}}]),a}(f.a.Component),_=function(e){Object(s.a)(a,e);var t=Object(c.a)(a);function a(e){var n;return Object(o.a)(this,a),(n=t.call(this,e)).handleChange=n.handleChange.bind(Object(l.a)(n)),n}return Object(i.a)(a,[{key:"handleChange",value:function(e){this.props.onMenuChange(this.props.filterDim.concept.code,e.target.value)}},{key:"render",value:function(){var e=this.props.filterDim,t=this.props.filterValue,a=e.conceptScheme.modalites.map((function(e,t){return f.a.createElement("option",{value:e.code,key:t},e.libelleFr)}));return f.a.createElement(v.a.Group,{controlId:e.concept.code},f.a.createElement(v.a.Label,null,e.concept.libelleFr),f.a.createElement(v.a.Control,{as:"select",value:t,onChange:this.handleChange},a))}}]),a}(f.a.Component);p.a.render(f.a.createElement(T,{dsd:"DERA_ds1",filterableDims:["ACTIVITE","PCS_ESE","AGE","SEXE"]}),document.getElementById("root"))},253:function(e,t){}},[[200,1,2]]]);
//# sourceMappingURL=main.6593ef01.chunk.js.map